{% extends "core/base.html" %}
{% load static i18n %}

{% block title %}Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© â€” Ù…ØªÙˆØ§ØªØ±{% endblock %}

{% if IS_ALPHA %}
<div id="alpha-banner" class="alpha-banner" role="status">
  Ù‡Ø°Ù‡ Ù†Ø³Ø®Ø© <strong>{{ APP_VERSION }}</strong> â€” Ù…Ø§ Ø²Ù„Ù†Ø§ Ù†ÙØ­Ø³Ù‘Ù† Ø§Ù„ØªØ¬Ø±Ø¨Ø©. Ù„Ùˆ Ù‚Ø§Ø¨Ù„ØªÙƒ Ù…Ø´ÙƒÙ„Ø©
  <a href="{% url 'core:complaint' %}">Ø¨Ù„ØºÙ‘Ù†Ø§ Ù…Ù† Ù‡Ù†Ø§</a>.
  <button id="alpha-dismiss" type="button" aria-label="Ø¥ØºÙ„Ø§Ù‚">Ã—</button>
</div>
{% endif %}

{% block content %}
<style>
  /* Ø¥Ø®ÙØ§Ø¡ ØªØ­ÙŠØ© Ø§Ù„Ù†Ø§ÙØ¨Ø§Ø± ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ù‡ÙˆÙ… ÙÙ‚Ø· */
  .nav-welcome, #nav-welcome, .top-welcome { display:none !important; }

  .home-shell{min-height:72vh; display:grid; align-content:start; gap:1.2rem}
  .welcome{
    text-align:center;
    padding:1.4rem 1rem 1rem;
    border-radius:16px;
    border:1px solid rgba(212,175,55,.22);
    background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));
    box-shadow: 0 18px 44px rgba(0,0,0,.22);
  }
  .welcome h1{
    margin:.2rem 0 .5rem; color:#fff; font-weight:900; letter-spacing:.2px; font-size:clamp(20px,3.2vw,26px)
  }
  .welcome .lead{ color:var(--muted); max-width:820px; margin:.2rem auto 0; }

  .chip{
    display:inline-flex;align-items:center;gap:.45rem;
    direction: rtl; /* Ø§Ù„Ø¯ÙˆØª ÙÙŠ Ø§Ù„ÙŠÙ…ÙŠÙ† */
    font-weight:800; color:#1b1b1b;
    background:linear-gradient(135deg,var(--accent),var(--accent-2));
    padding:.38rem .7rem; border-radius:999px; border:1px solid rgba(212,175,55,.55);
  }
  .chip .dot{
    width:10px;height:10px;border-radius:50%;
    background:#16a34a; /* Ø£Ø®Ø¶Ø± */
    box-shadow:0 0 0 6px rgba(22,163,74,.15);
    animation:pulse 1.8s ease-in-out infinite;
  }
  @keyframes pulse{
    0%,100%{ box-shadow:0 0 0 6px rgba(22,163,74,.15) }
    50%{ box-shadow:0 0 0 9px rgba(22,163,74,.30) }
  }
  .badge-medal{margin-inline-start:.4rem; font-weight:900}

  .home-cta{display:flex; gap:.6rem; justify-content:center; flex-wrap:wrap; margin-top:1rem}
  .btn-lg{padding:.8rem 1.15rem; border-radius:12px; font-weight:900}

  .grid-cards{display:grid; grid-template-columns:repeat(3,1fr); gap:.9rem}
  @media (max-width: 900px){ .grid-cards{grid-template-columns:1fr} }
  .cardx{
    position:relative;
    background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));
    border:1px solid rgba(255,255,255,.10);
    border-radius:16px; padding:1.1rem 1.15rem;
    box-shadow:0 14px 36px rgba(0,0,0,.22);
    display:grid; gap:.5rem;
  }
  .cardx h3{margin:0; color:#fff; font-weight:900}
  .cardx p{margin:0; color:var(--muted)}
  .cardx .go{justify-self:start; margin-top:.35rem}

  /* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
  .stats-grid{
    display:grid; grid-template-columns:repeat(4,1fr); gap:.6rem; margin:.2rem 0 .4rem;
  }
  @media(max-width:700px){ .stats-grid{grid-template-columns:repeat(2,1fr)} }
  .stat{
    background:#0f1118; border:1px solid rgba(255,255,255,.10);
    border-radius:14px; padding:.65rem .7rem; text-align:center;
    box-shadow:0 10px 28px rgba(0,0,0,.20);
  }
  .stat .num{display:block; font-weight:900; font-size:clamp(18px,4vw,24px); color:#fff}
  .stat .lbl{display:block; font-weight:800; color:#9aa3b2; margin-top:.15rem; font-size:.95rem}

  .title-underline{
    height:2px; background:linear-gradient(90deg, transparent, var(--accent), transparent);
    border-radius:2px; margin:.35rem auto 0; width:180px; opacity:.65;
  }

  .about{
    margin-top:1rem;
    background:linear-gradient(135deg, #fff8ec22, #f3efe622);
    border-inline-start:6px solid var(--accent);
    padding: .8rem 1rem; border-radius:12px;
    box-shadow:0 10px 30px rgba(212,175,55,.15);
  }
  .about .title{margin:.1rem 0 .4rem; color:#fff; font-weight:900}
  .about p{margin:0; color:#e9f5ef}
</style>

<div class="home-shell">

  <section class="welcome">
    <!-- Ø¨Ø§Ø¯Ø¬ Ø§Ù„ØªØ±Ø­ÙŠØ¨ (Ø§Ù„Ø¯ÙˆØª ÙÙŠ Ø§Ù„ÙŠÙ…ÙŠÙ†) -->
    <div class="chip" style="margin-bottom:.55rem">
      <span class="dot" aria-hidden="true"></span>
      Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ {{ student.display_name|default:request.user.username }}
      {% if my_rank and my_rank|add:0 <= 3 %}
        <span class="badge-medal">
          {% if my_rank == 1 %}ğŸ¥‡{% elif my_rank == 2 %}ğŸ¥ˆ{% else %}ğŸ¥‰{% endif %} #{{ my_rank }}
        </span>
      {% endif %}
    </div>

    <h1>Ù…ØªÙˆØ§ØªØ± â€” <span style="color:var(--accent)">Mutawatir</span></h1>
    <div class="title-underline"></div>
    <p class="lead">
      Ù…Ù†ØµØ© Ù…ØªØ·ÙˆØ±Ø© Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØªØ«Ø¨ÙŠØª Ø­ÙØ¸ Ø§Ù„Ù‚Ø±Ø¢Ù†ØŒ ÙˆØªØ±Ø³ÙŠØ® ØµÙˆØ±Ø© Ø§Ù„Ù…ØµØ­Ù ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©.
    </p>

    <div class="home-cta">
      <!-- ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„ÙˆØ¬Ù‡Ø© Ø¥Ù„Ù‰ ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª -->
      <a href="/tests/" class="btn btn-primary btn-lg">Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯</a>
      {% if request.session.questions %}
        <a href="{% url 'core:test_question' %}" class="btn btn-outline btn-lg">Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</a>
      {% endif %}
      <a href="{% url 'core:complaint' %}" class="btn btn-outline btn-lg">Ø¥Ø¨Ù„Ø§Øº / Ø§Ù‚ØªØ±Ø§Ø­</a>
    </div>
  </section>

<section class="grid-cards" aria-label="Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
  <article class="cardx">
    <h3>Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø­ÙØ¸</h3>
    <p>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø«Ù… Ø­Ø¯Ù‘Ø¯ Ù†Ø·Ø§Ù‚Ùƒ (Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡/Ø§Ù„Ø£Ø±Ø¨Ø§Ø¹/Ø§Ù„Ø³ÙˆØ±) ÙˆØ§Ø¨Ø¯Ø£.</p>
    <!-- ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„ÙˆØ¬Ù‡Ø© Ø¥Ù„Ù‰ ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª -->
    <a href="/tests/" class="btn btn-primary go">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†</a>
  </article>

  <article class="cardx">
    <h3>Ø§Ù„Ø¥Ø¨Ù„Ø§Øº ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h3>
    <p>ÙˆØ§Ø¬Ù‡Øª Ù…Ø´ÙƒÙ„Ø© Ø£Ùˆ Ø¹Ù†Ø¯Ùƒ Ø§Ù‚ØªØ±Ø§Ø­ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ¬Ø±Ø¨Ø©ØŸ Ø´Ø§Ø±ÙƒÙ†Ø§ Ø±Ø£ÙŠÙƒ Ù„Ù†Ø­Ø³Ù‘Ù† Ø§Ù„Ù…Ù†ØµØ© Ø¨Ø§Ø³ØªÙ…Ø±Ø§Ø±.</p>
    <a href="{% url 'core:complaint' %}" class="btn btn-outline go">Ø¥Ø±Ø³Ø§Ù„ Ù…Ù„Ø§Ø­Ø¸Ø©</a>
  </article>

  <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙƒ (Ø³ØªØ§ÙŠÙ„ Ù…Ù…Ø§Ø«Ù„ Ù„ØµÙØ­Ø© /stats/) -->
  <article class="cardx">
    <h3>Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙƒ</h3>

    <style>
      .stats-tiles{
        display:grid;
        grid-template-columns:repeat(4,1fr);
        gap:.6rem;
        margin:.4rem 0 .6rem;
      }
      @media(max-width:700px){ .stats-tiles{grid-template-columns:repeat(2,1fr)} }
      .tile{
        background:#0b0f16;
        border:1px solid rgba(255,255,255,.10);
        border-radius:14px;
        padding:.8rem .9rem;
        text-align:center;
        box-shadow:0 10px 28px rgba(0,0,0,.18);
      }
      .tile .v{display:block; font-weight:900; font-size:clamp(22px,4.6vw,28px); color:#fff}
      .tile .k{display:block; font-weight:800; color:#9aa3b2; margin-top:.2rem; font-size:.95rem}
    </style>

    <div class="stats-tiles">
      <div class="tile"><span class="v">{{ stats.exams }}</span><span class="k">Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</span></div>
      <div class="tile"><span class="v">{{ stats.correct }}</span><span class="k">ØµØ­ÙŠØ­</span></div>
      <div class="tile"><span class="v">{{ stats.wrong }}</span><span class="k">Ø®Ø·Ø£</span></div>
      <div class="tile"><span class="v">{{ stats.unanswered }}</span><span class="k">ØºÙŠØ± Ù…ÙØ¬Ø§Ø¨</span></div>
    </div>

    <a href="{% url 'core:stats' %}" class="btn btn-outline go">Ø¹Ø±Ø¶ ØªÙØµÙŠÙ„ÙŠ</a>
  </article>
</section>


    <!-- Ø­Ø³Ø§Ø¨Ùƒ -->
    <article class="cardx">
      <h3>Ø­Ø³Ø§Ø¨Ùƒ</h3>
      <p>Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¶: <strong>{{ student.display_name|default:request.user.username }}</strong></p>
      {% if request.user.email %}
        <p>Ø§Ù„Ø¨Ø±ÙŠØ¯: <strong>{{ request.user.email }}</strong></p>
      {% endif %}
      <div style="display:flex; gap:.5rem; flex-wrap:wrap; margin-top:.35rem">
        <a href="{% url 'core:account_settings' %}" class="btn btn-primary">ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</a>
        <a href="{% url 'core:logout' %}" class="btn btn-outline">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
        {% if request.session.questions %}
          <a href="{% url 'core:test_question' %}" class="btn btn-outline">Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</a>
        {% endif %}
      </div>
    </article>

    <!-- ÙƒØ§Ø±Øª Ø§Ù„Ù„ÙˆØ­Ø© -->
    <article class="cardx">
      <h3>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù†Ø§ÙØ³Ø©</h3>
      <p>Ø´Ø§Ù‡Ø¯ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ù„Ù†Ø´Ø§Ø·.</p>
      {% if my_rank %}<p>ØªØ±ØªÙŠØ¨Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ: <b>#{{ my_rank }}</b></p>{% endif %}
      <a href="{% url 'core:leaderboard' %}" class="btn btn-primary go">ÙØªØ­ Ø§Ù„Ù„ÙˆØ­Ø©</a>
    </article>
  </section>

  <section class="about" aria-labelledby="about-title">
    <h2 id="about-title" class="title">Ø¹Ù† Ù…ØªÙˆØ§ØªØ±</h2>
    <p>
      "Ù…ØªÙˆØ§ØªØ±" Ù‡Ùˆ Ù…ÙˆÙ‚Ø¹ ØªÙØ§Ø¹Ù„ÙŠ Ù…Ø¨ØªÙƒØ± ÙŠÙ‡Ø¯Ù Ø¥Ù„Ù‰ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø­ÙØ¸Ø© Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… Ø¹Ù„Ù‰ Ø§Ø®ØªØ¨Ø§Ø± ÙˆØªÙ‚ÙˆÙŠØ© Ø­ÙØ¸Ù‡Ù…ØŒ
      Ù…Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ø¢ÙŠØ§Øª Ø§Ù„Ù…ØªØ´Ø§Ø¨Ù‡Ø©. ÙŠÙˆÙØ± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø¯Ù‚ÙŠÙ‚Ø© ØªÙØ¨Ù†Ù‰ Ø¹Ù„Ù‰ Ø§Ø®ØªÙŠØ§Ø±Ù‡Ù… Ù„Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø£Ùˆ Ø§Ù„Ø£Ø±Ø¨Ø§Ø¹ Ø£Ùˆ Ø§Ù„Ø³ÙˆØ±ØŒ
      Ù…Ø¹ Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©ØŒ Ù…Ù…Ø§ ÙŠØ³Ø§Ø¹Ø¯ Ø¹Ù„Ù‰ Ø§Ù„ØªØ«Ø¨ÙŠØª ÙˆØªØ±Ø³ÙŠØ® ØµÙˆØ±Ø© Ø§Ù„Ù…ØµØ­Ù ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©.
    </p>
  </section>

</div>

<!-- Ø¥Ø®ÙØ§Ø¡ Ø£ÙŠ "Ù…Ø±Ø­Ø¨" ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± Ø¨Ø¬ÙˆØ§Ø± "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬" Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© ÙÙ‚Ø· -->
<script>
  document.addEventListener('DOMContentLoaded', function(){
    function hideNavWelcome(){
      var containers = document.querySelectorAll('header, nav, .navbar, .topbar, .site-header');
      containers.forEach(function(h){
        var hasLogout = /(ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬|Log ?out)/.test((h.textContent||'')); if(!hasLogout) return;
        h.querySelectorAll('*').forEach(function(el){
          if(el.children.length===0){
            var t=(el.textContent||'').trim();
            if(/Ù…Ø±Ø­Ø¨/.test(t)){ el.style.display='none'; }
          }
        });
      });
    }
    hideNavWelcome();
    new MutationObserver(hideNavWelcome).observe(document.body,{subtree:true,childList:true});
  });
</script>
{% endblock %}
